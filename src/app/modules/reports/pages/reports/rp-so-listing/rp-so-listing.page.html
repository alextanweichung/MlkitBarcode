<ion-header>
  <ion-toolbar>
    <ion-title>SO Listing</ion-title>
    <ion-buttons slot="start">
      <ion-back-button text="Back" defaultHref="/reports"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <div class="p-2">
    <!-- <ion-list class="list-custom" lines="none">
      <app-search-multi-dropdown title="Debtor" [showHeaderLabel]="true" [showBoldHeader]="true" [showCode]="true"  [searchDropdownList]="customerSearchDropdownList" (onActionComplete)="onCustomerSelected($event)"></app-search-multi-dropdown>
      <ion-item class="ion-flex ion-flex-center" lines="none">
        <ion-checkbox slot="end" [(ngModel)]="isOverdueOnly"></ion-checkbox>
        <ion-label>
          <div class="ion-text-small">Overdue Only</div>
        </ion-label>
      </ion-item>
      <app-calendar-input title="Statement Date" [date_value]="trxDate" (onDateSelected)="onDateSelected($event)"></app-calendar-input>
    </ion-list> -->
    <ion-button class="pt-2" expand="block" size="default" (click)="loadObjects()">Search</ion-button>
    <ngx-datatable *ngIf="objects && objects.length > 0"
    class="fullscreen material mt-2"
    [rows]="objects" 
    [rowHeight]="'auto'" 
    [columns]="columns"
    [columnMode]="'force'" 
    [footerHeight]="50"
    [limit]="12"
    [scrollbarH]="true">
      <ngx-datatable-column prop="issuedDate" name="Issued Date" [width]="120">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <div class="flex ion-text-wrap font-half-size">{{row.issuedDate|date:'dd/MM/yyyy'}}</div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column prop="debtorCode" name="Debtor Code" [width]="100">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <div class="flex ion-text-wrap font-half-size">{{row.debtorCode}}</div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column prop="debtorName" name="Debtor Name" [width]="100">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <div class="flex ion-text-wrap font-half-size">{{row.debtorName}}</div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column prop="salesmanName" name="Salesman" [width]="100">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <div class="flex ion-text-wrap font-half-size">{{row.salesmanName}}</div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column prop="orderStatus" name="Order Status" [width]="120">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <div class="flex ion-text-wrap font-half-size">{{row.orderStatus}}</div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column prop="salesOrderNum" name="Sales Order" [width]="100">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <div class="font-half-size div-link-button" (click)="presentAlertViewPdf(row.salesOrderId, row.salesOrderNum, 'SO')"> {{row.salesOrderNum}}</div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column prop="deliveryOrderIds" name="Delivery Order" [width]="120">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <div class="font-half-size div-link-button" (click)="showDialogOrDownload(row.deliveryOrderIds)"> {{row.deliveryOrders?.replace('|', ', ')}}</div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column prop="delivered" name="Delivered" [width]="100">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <div class="flex ion-text-wrap font-half-size">{{row.delivered}}</div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column prop="netAmount" name="Net Amount" [width]="100">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <div class="font-half-size ion-text-right"> {{row.netAmount | number:'1.2-2'}}</div>
        </ng-template>
      </ngx-datatable-column>
    </ngx-datatable>
  </div>
</ion-content>
<ion-modal [isOpen]="doDialog" (didDismiss)="doDialog = false">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Delivery Orders</ion-title>
        <ion-buttons slot="start">
          <ion-button (click)="hideDoDialog()">Done</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <div class="p-2">
        {{error|json}}
        <ion-list-header class="ion-list-header-small ion-flex ion-text-center" *ngIf="!deliveryOrderObject">
          <ion-label>Delivery Orders not available.</ion-label>
        </ion-list-header>
        <ion-list class="list-custom" lines="none">          
          <ion-item button="false" *ngFor="let dOrder of deliveryOrderObject">
            <ion-grid class="p-1">
              <ion-row>
                <ion-col class="ion-margin-auto">
                  <div>{{dOrder.split('|')[0]}}</div>
                </ion-col>
                <ion-col>
                  <div class="ion-text-right"><ion-button fill="clear" size="small" (click)="presentAlertViewPdf(dOrder.split('|')[1], dOrder.split('|')[0], 'DO')">Download</ion-button></div>
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-item>
        </ion-list>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>
